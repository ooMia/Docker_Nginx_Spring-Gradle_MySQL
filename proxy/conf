events{

}

http {
    server {
        listen       80;
        server_name  localhost;

        location / {
          rewrite /(.*) /$1 break;
          proxy_pass http://localhost;
        }
        location /app {
          rewrite /app/(.*) /$1 break;
            location /cache {
            rewrite /cache/(.*) /$1 break;
            proxy_pass http://cacheHost/app;
            }
            location /main {
            rewrite /main/(.*) /$1 break;
            proxy_pass http://mainHost/app;
            }
          proxy_pass http://localhost;
        }
    }
}

upstream mainHost {
  server mainHost:8080;
}

upstream cacheHost {
  server cacheHost:8000;
}

upstream localhost {
  server localhost:8080;
}
